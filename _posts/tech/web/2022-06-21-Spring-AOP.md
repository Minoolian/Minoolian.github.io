---
layout: post
title: "Spring AOP"
category: tech
tags: web spring
image:
  path:   https://user-images.githubusercontent.com/44282342/174726342-1dd83191-8f51-42cc-8c1a-76df9f3c1be2.png
---

* unordered toc
{:toc .large-only}

μ΄λ² ν¬μ¤ν…μ€ **Spring AOP**μ— λ€ν•΄ μ•μ•„λ³΄λ ¤ν•λ‹¤.

## AOP (Aspect Oriented Programming)
***

`ν•µμ‹¬ κ΄€μ‹¬μ‚¬(ν•µμ‹¬κΈ°λ¥)`μ™€ `ν΅λ‹¨ κ΄€μ‹¬μ‚¬(λ¶€κ°€κΈ°λ¥)`κ°€ κ³µμ΅΄ν•λ©΄μ„ λ©”μ„λ“μ λ³µμ΅λ„κ°€ λ†’μ•„μ§€κ³ , μ½”λ“κ°€ μ§€μ €λ¶„ν•΄μ§€κ² λμ—λ‹¤. λ”°λΌμ„ OOPλ§μΌλ΅λ” μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•  μ μ—†κΈ°μ— **AOPκ°€ λ“±μ¥**ν•μ€λ‹¤.

μ¤ν”„λ§μ—μ„ AspectJλ¥Ό μ‚¬μ©ν•κΈ° μ„ν•΄ μµμƒμ„ ν¨ν‚¤μ§€ ν΄λμ¤μ— `@EnableAspectJAutoProxy` μ–΄λ…Έν…μ΄μ…μ„ μ¶”κ°€ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.

```java
@EnableAspectJAutoProxy
@SpringBootApplication
public class DemoApplication {

	public static void main(String[] args) {
		SpringApplication.run(CmarketApplication.class, args);
	}
}
```

## AOP μ©μ–΄ λ° κ°λ…
***

![Adviceμ™€ JoinPintμ κ΄€κ³„](https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Faa82f0ab-a955-40e4-a15a-4d77661833c2%2FUntitled.png?table=block&id=0a3c2d8f-bd8e-46cd-8d8d-00936442fbd3&spaceId=f6562176-b9b7-40a3-8387-ce49c6f98fe8&width=2000&userId=7ff29728-065b-4cd4-bf01-375a94766527&cache=v2)

### Aspect

* Concernμ„ λ¬¶μ–΄μ„ λ¨λ“ν™”ν• κ²ƒ. ν•λ‚μ λ¨λ“. Adviceμ™€ PointCutμ΄ λ“¤μ–΄κ°„λ‹¤.

### JoinPoint

* ν΄λμ¤ μ΄κΈ°ν™”, κ°μ²΄ μΈμ¤ν„΄μ¤ν™”, λ©”μ†λ“ νΈμ¶ λ“±μ νΉμ • ν¬μΈνΈλ¥Ό μλ―Έν•λ‹¤. λ‹¤λ§ μ¤ν”„λ§ AOPμ—μ„λ” **ν”„λ΅μ‹ λ°©μ‹**μ„ μ‚¬μ©ν•λ―€λ΅ `λ©”μ„λ“ μ‹¤ν–‰ μ‹μ `μΌλ΅ μ ν•λλ‹¤.
* μ΅°μΈν¬μΈνΈμ— κ΄€μ‹¬μ½”λ“λ΅ μƒλ΅μ΄ λ™μ‘μ„ μ¶”κ°€ν•  μ μλ‹¤.

### Advice

* JoinPointμ—μ„ μν–‰λλ” μ½”λ“μ΄λ‹¤.
* Aspectλ¥Ό ν•µμ‹¬μ½”λ“μ— μ–Έμ  μ μ©ν• μ§€ μ„ μ–Έν•λ‹¤.

### Pointcut

* Adviceκ°€ μ μ©λ  JoinPoint μ„μΉλ¥Ό κ²°μ •ν•λ‹¤.
* AspectJ ν‘ν„μ‹μ„ μ‚¬μ©ν•λ©°, μ„μ— μ–ΈκΈ‰ν–λ“― μ¤ν”„λ§ AOPμ—μ„λ” λ©”μ†λ“ μ‹¤ν–‰μ§€μ λ§ κ°€λ¥ν•λ‹¤.

### Target

* **Adviceλ¥Ό λ°›λ”** `κ°μ²΄`, μ¦‰ ν•µμ‹¬ κΈ°λ¥μ„ λ‹΄κ³  μλ” κ°μ²΄μ΄λ‹¤.

## Adviceμ μΆ…λ¥
***

|μΆ…λ¥|μ„¤λ…|
|:--|:--|
|Before|μ΅°μΈ ν¬μΈνΈ μ‹¤ν–‰ μ΄μ „|
|After returning|μ΅°μΈ ν¬μΈνΈ μ •μƒ μ™„λ£ν›„|
|After throwing|λ©”μ„λ“μ—μ„ μμ™Έλ¥Ό λμ§€λ” κ²½μ°|
|After|μ •μƒκ³Ό μμ™Έμ— μƒκ΄€μ—†μ΄ μ‹¤ν–‰(finally)|
|**Around**|λ©”μ„λ“ νΈμ¶ μ „ν›„μ— μν–‰|
{:.stretch-table}

λ¨λ‘ λ©”μ„λ“μ μΈμλ΅ `JoinPoint`λ¥Ό λ°›μ§€λ§ `@Around` μ–΄λ…Έν…μ΄μ…λ§ `ProceedingJoinPoint`λ¥Ό μΈμλ΅ λ°›λ”λ‹¤.

`@Around` μ–΄λ…Έν…μ΄μ…μΌλ΅ λ¨λ‘ μ²λ¦¬ κ°€λ¥ν•μ§€λ§, κ°„κ²°ν•κ² **ν•„μ”ν• μ–΄λ…Έν…μ΄μ…**μ„ μ‚¬μ©ν•λ” κ²ƒμ΄ μΆ‹μ€ μ„¤κ³„λΌν•  μ μλ‹¤.

> Advice μμ„λ” λ³΄μ¥λμ§€ μ•μΌλ―€λ΅ ν΄λμ¤ λ λ²¨μ— μ μ©ν•λ” @Order μ–΄λ…Έν…μ΄μ…μ— λ€ν•΄ μ•μ•„λ³΄λ©΄ μΆ‹μ„ κ²ƒ κ°™λ‹¤.

## Pointcut ν‘ν„μ‹
***

`execution([μ ‘κ·Όμ ν•μ ν¨ν„΄] λ¦¬ν„΄κ°’μ νƒ€μ… [ν¨ν‚¤μ§€, ν΄λμ¤λ…] λ©”μ„λ“λ…(νλΌλ―Έν„°νƒ€μ…) [throws μμ™Έν¨ν„΄])`

```java
exectuion(* com.example.demo.*.*(..))
```

## JoinPoint
***

μ¤ν”„λ§ AOPμ JoinPointλ” **λ©”μ„λ“ μ‹¤ν–‰ μ‹μ **μ΄λ©°, **μ¤ν”„λ§ Bean**μ—λ§ μ μ©ν•  μ μλ‹¤.

### JoinPoint μΈν„°νμ΄μ¤

|λ©”μ„λ“|μ„¤λ…|
|:--|:--|
|getArgs()|JoinPointμ— μ „λ‹¬λ μΈμ λ°ν™|
|getThis()|AOP ν”„λ΅μ‹ κ°μ²΄ λ°ν™|
|getTarget()|AOP μ μ©λ κ°μ²΄ λ°ν™|
|getSignature()|Adviceκ°€ μ μ©λλ” λ©”μ„λ“μ— λ€ν• μ„¤λ…μ„ λ°ν™|
{:.stretch-table}

`@Around` μ–΄λ…Έν…μ΄μ…μ—μ„ μ‚¬μ©ν•λ” `ProceedingJoinPoint μΈν„°νμ΄μ¤`λ” λ‹¤μ Adivceλ¥Ό νΈμ¶ν•λ” `proceed()` λ©”μ„λ“κ°€ μλ‹¤.

## κ²°λ΅ 
***

AOPλ¥Ό ν†µν•΄ κ°„λ‹¨ν• λ©”μ„λ“ μ‹¤ν–‰μ‹κ°„ μΈ΅μ •μ •λ„λ” μν–‰ν•΄λ³΄μ•μ§€λ§ μ‹¤μ§μ μΌλ΅ μ‚¬μ©λ  **νΈλμ­μ…μ΄λ‚ λ΅κΉ…**λ¶€λ¶„μ€ λ‚΄ μ†μΌλ΅ μ§μ ‘ μ§λ³΄μ§ μ•μ•λ‹¤π¥ μ•„λ§ μ§€κΈ μ§„ν–‰μ¤‘μΈ CoCo ν”„λ΅μ νΈμ—μ„ λ¶„λ…ν ν•„μ”ν• λ¶€λ¶„μ΄κ±°λ‹μ™€ μ½”λ“μ¤ν…μ΄μΈ  μ»¤λ¦¬νλΌμ—λ„ ν¬ν•¨λμ–΄μμΌλ‹ `λ‚΄ μ†μΌλ΅ κµ¬ν„ν•  λ‚ μ΄ μ¬ κ²ƒμ΄λΌ κΈ°λ€ν•λ‹¤π‰`

λν• ν”„λ΅μ νΈμ—μ„ Controllerλ‹¨μ— λ°μƒν•λ” μμ™Έλ¥Ό `Exception Handling`ν•  μμ •μ΄μ—λ”λ° λ§μΉ¨ AOPμ— λ€ν•΄ ν•™μµν•μ—¬ μμ›”ν•κ² μ§„ν–‰ν•  μ μμ„ κ²ƒμ΄λ‹¤.